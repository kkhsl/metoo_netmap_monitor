<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.metoo.monitor.core.mapper.version.MetooVersionClientMapper">
    <select id="list" parameterType="com.metoo.monitor.core.vo.version.MetooVersionClientQueryVo" resultType="com.metoo.monitor.core.entity.version.MetooVersionClient">
            select * from metoo_version_client a
            inner join (
            WITH RECURSIVE Tree AS (
                SELECT id, name, parent_id
                FROM metoo_area
                where unit_id is null
                <if test="areaId == null and areaId == '' ">
                    AND parent_id = #{areaId}
                </if>
                <if test="areaId != null and areaId != ''">
                    AND id = #{areaId}
                </if>
               and id=1
                UNION ALL
                SELECT t.id, t.name, t.parent_id
                FROM metoo_area t
                JOIN Tree ON t.parent_id = Tree.id
                    where   t.unit_id is null
            )
            SELECT *
            FROM Tree
            ) b
            on a.area_id =b.id
        <where>
            and a.delete_status=0
            <if test="unitName != null and unitName != ''">
                AND a.unit_name like concat(#{unitName},'%')
            </if>
        </where>
        <if test="orderBy != null and orderBy != ''">
            ORDER BY ${orderBy}
        </if>
        <if test="orderType != null and orderType != ''">
            ${orderType}
        </if>
    </select>
    <insert id="save" parameterType="com.metoo.monitor.core.entity.version.MetooVersionClient">
        insert into metoo_version_client
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="unitId != null">
                unit_id,
            </if>
            <if test="unitName != null">
                unit_name,
            </if>
            <if test="areaId != null">
                area_id,
            </if>
            <if test="curVersionId != null">
                cur_version_id,
            </if>
            <if test="curVersion != null">
                cur_version,
            </if>
            <if test="appVersionId != null">
                app_version_id,
            </if>
            <if test="appVersion != null">
                app_version,
            </if>
            <if test="clientStatus != null">
                client_status,
            </if>
            <if test="deleteStatus != null">
                delete_status,
            </if>
            <if test="createBy != null">
                create_by,
            </if>
            <if test="createName != null">
                create_name,
            </if>
            <if test="addTime != null">
                add_time,
            </if>
            <if test="updateBy != null">
                update_by,
            </if>
            <if test="updateName != null">
                update_name,
            </if>
            <if test="updateTime != null">
                update_time,
            </if>
            <if test="versionStatus != null">
                version_status,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="unitId != null">
                #{unitId,jdbcType=VARCHAR},
            </if>
            <if test="unitName != null">
                #{unitName,jdbcType=VARCHAR},
            </if>
            <if test="areaId != null">
                #{areaId,jdbcType=BIGINT},
            </if>
            <if test="curVersionId != null">
                #{curVersionId,jdbcType=BIGINT},
            </if>
            <if test="curVersion != null">
                #{curVersion,jdbcType=VARCHAR},
            </if>
            <if test="appVersionId != null">
                #{appVersionId,jdbcType=BIGINT},
            </if>
            <if test="appVersion != null">
                #{appVersion,jdbcType=VARCHAR},
            </if>
            <if test="clientStatus != null">
                #{clientStatus,jdbcType=TINYINT},
            </if>
            <if test="deleteStatus != null">
                #{deleteStatus,jdbcType=TINYINT},
            </if>
            <if test="createBy != null">
                #{createBy,jdbcType=BIGINT},
            </if>
            <if test="createName != null">
                #{createName,jdbcType=VARCHAR},
            </if>
            <if test="addTime != null">
                #{addTime,jdbcType=TIMESTAMP},
            </if>
            <if test="updateBy != null">
                #{updateBy,jdbcType=BIGINT},
            </if>
            <if test="updateName != null">
                #{updateName,jdbcType=VARCHAR},
            </if>
            <if test="updateTime != null">
                #{updateTime,jdbcType=TIMESTAMP},
            </if>
            <if test="versionStatus != null">
                #{versionStatus,jdbcType=TINYINT},
            </if>
        </trim>
    </insert>
    <update id="deleteById" parameterType="java.lang.Long">
      update metoo_version_client set delete_status=1
      where id = #{id,jdbcType=BIGINT}
    </update>
    <select id="detail" parameterType="java.lang.Long" resultType="com.metoo.monitor.core.entity.version.MetooVersionClient">
        select * from metoo_version_client
           where id = #{id,jdbcType=BIGINT}
           and delete_status=0
    </select>
</mapper>
